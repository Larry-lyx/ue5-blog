<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 8.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/ue5-blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/ue5-blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/ue5-blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/ue5-blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/ue5-blog/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"larry-lyx.github.io","root":"/ue5-blog/","images":"/ue5-blog/images","scheme":"Gemini","darkmode":false,"version":"8.26.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/ue5-blog/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/ue5-blog/js/config.js" defer></script>

    <meta name="description" content="核心总结GameplayEffect（GE）是GAS框架中实现属性修改、传递附加效果信息的核心载体，其核心逻辑围绕“数值计算+信息传递+效果生效”展开：  核心功能：一方面通过硬编码、SetByCaller、Execution Class、MMC等不同复杂度的方式计算属性修改值（如伤害值）；另一方面通过自定义Context或Tag传递暴击、格挡、击退、Debuff等附加效果信息，最终在Attrib">
<meta property="og:type" content="article">
<meta property="og:title" content="GameplayEffect (GE)">
<meta property="og:url" content="https://larry-lyx.github.io/ue5-blog/2025/12/12/GAS-GE/index.html">
<meta property="og:site_name" content="UE5学习笔记博客">
<meta property="og:description" content="核心总结GameplayEffect（GE）是GAS框架中实现属性修改、传递附加效果信息的核心载体，其核心逻辑围绕“数值计算+信息传递+效果生效”展开：  核心功能：一方面通过硬编码、SetByCaller、Execution Class、MMC等不同复杂度的方式计算属性修改值（如伤害值）；另一方面通过自定义Context或Tag传递暴击、格挡、击退、Debuff等附加效果信息，最终在Attrib">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-12-11T16:00:00.000Z">
<meta property="article:modified_time" content="2025-12-14T01:41:40.889Z">
<meta property="article:author" content="Larry-lyx">
<meta property="article:tag" content="GAS">
<meta property="article:tag" content="GE">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://larry-lyx.github.io/ue5-blog/2025/12/12/GAS-GE/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://larry-lyx.github.io/ue5-blog/2025/12/12/GAS-GE/","path":"/2025/12/12/GAS-GE/","title":"GameplayEffect (GE)"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>GameplayEffect (GE) | UE5学习笔记博客</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/ue5-blog/js/utils.js" defer></script><script src="/ue5-blog/js/motion.js" defer></script><script src="/ue5-blog/js/sidebar.js" defer></script><script src="/ue5-blog/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/ue5-blog/js/third-party/search/local-search.js" defer></script>







  





  <noscript>
    <link rel="stylesheet" href="/ue5-blog/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/ue5-blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">UE5学习笔记博客</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">从入门到精通，持续更新</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/ue5-blog/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/ue5-blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/ue5-blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/ue5-blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E6%80%BB%E7%BB%93"><span class="nav-number">1.</span> <span class="nav-text">核心总结</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#GE-%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="nav-number">2.</span> <span class="nav-text">GE 的作用</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%9E%E6%88%98%E8%A7%A3%E6%9E%90-Damage"><span class="nav-number">3.</span> <span class="nav-text">实战解析 Damage</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%B0%81%E8%A3%85%E4%BC%A4%E5%AE%B3%E5%8F%82%E6%95%B0%EF%BC%88FDamageEffectParams%EF%BC%89"><span class="nav-number">3.1.</span> <span class="nav-text">1. 封装伤害参数（FDamageEffectParams）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%9E%84%E5%BB%BA-GE-%E5%AE%9E%E4%BE%8B%EF%BC%88%E9%80%9A%E7%94%A8%E5%87%BD%E6%95%B0%EF%BC%89"><span class="nav-number">3.2.</span> <span class="nav-text">2. 构建 GE 实例（通用函数）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A1%AB%E5%86%99-GameplayEffectContext"><span class="nav-number">3.2.1.</span> <span class="nav-text">填写 GameplayEffectContext</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%B6%E4%BD%9C-GameplayEffectSpec"><span class="nav-number">3.2.2.</span> <span class="nav-text">制作 GameplayEffectSpec</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%94%E7%94%A8-GameplayEffect-%E5%88%B0%E7%9B%AE%E6%A0%87"><span class="nav-number">3.2.3.</span> <span class="nav-text">应用 GameplayEffect 到目标</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Exec-Damage-%E5%AE%9A%E5%88%B6%E5%8C%96%E8%AE%A1%E7%AE%97"><span class="nav-number">3.2.3.1.</span> <span class="nav-text">Exec_Damage 定制化计算</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A41%EF%BC%9A%E5%AE%9A%E4%B9%89%E5%B9%B6%E6%B3%A8%E5%86%8C%E5%B1%9E%E6%80%A7%E6%8D%95%E8%8E%B7%E8%A7%84%E5%88%99"><span class="nav-number">3.2.3.1.1.</span> <span class="nav-text">步骤1：定义并注册属性捕获规则</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A42%EF%BC%9A%E6%B3%A8%E5%86%8C%E6%8D%95%E8%8E%B7%E8%A7%84%E5%88%99"><span class="nav-number">3.2.3.1.2.</span> <span class="nav-text">步骤2：注册捕获规则</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A43%EF%BC%9A%E4%BD%BF%E7%94%A8%E6%8D%95%E8%8E%B7%E5%B1%9E%E6%80%A7%E8%AE%A1%E7%AE%97%E4%BC%A4%E5%AE%B3"><span class="nav-number">3.2.3.1.3.</span> <span class="nav-text">步骤3：使用捕获属性计算伤害</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RadialDamage-%E8%8C%83%E5%9B%B4%E4%BC%A4%E5%AE%B3%E5%AE%9E%E7%8E%B0"><span class="nav-number">3.2.3.2.</span> <span class="nav-text">RadialDamage 范围伤害实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Debuff-%E5%A4%84%E7%90%86"><span class="nav-number">3.2.3.3.</span> <span class="nav-text">Debuff 处理</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Debuff%E7%9A%84%E7%94%9F%E6%95%88"><span class="nav-number">4.</span> <span class="nav-text">Debuff的生效</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ModMagCalc-MMC"><span class="nav-number">5.</span> <span class="nav-text">ModMagCalc (MMC)</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Larry-lyx</p>
  <div class="site-description" itemprop="description">分享 UE5 实用编程技巧，以及各种游戏系统的设计思路，方便查询和回顾</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/ue5-blog/archives/">
          <span class="site-state-item-count">31</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/ue5-blog/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/ue5-blog/tags/">
        <span class="site-state-item-count">40</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://larry-lyx.github.io/ue5-blog/2025/12/12/GAS-GE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/ue5-blog/images/avatar.gif">
      <meta itemprop="name" content="Larry-lyx">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="UE5学习笔记博客">
      <meta itemprop="description" content="分享 UE5 实用编程技巧，以及各种游戏系统的设计思路，方便查询和回顾">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="GameplayEffect (GE) | UE5学习笔记博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          GameplayEffect (GE)
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-12 00:00:00" itemprop="dateCreated datePublished" datetime="2025-12-12T00:00:00+08:00">2025-12-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-12-14 09:41:40" itemprop="dateModified" datetime="2025-12-14T09:41:40+08:00">2025-12-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/ue5-blog/categories/SystemDesigns/" itemprop="url" rel="index"><span itemprop="name">SystemDesigns</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/ue5-blog/categories/SystemDesigns/GAS/" itemprop="url" rel="index"><span itemprop="name">GAS</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="核心总结"><a href="#核心总结" class="headerlink" title="核心总结"></a>核心总结</h1><p>GameplayEffect（GE）是GAS框架中实现属性修改、传递附加效果信息的核心载体，其核心逻辑围绕“数值计算+信息传递+效果生效”展开：</p>
<ol>
<li><strong>核心功能</strong>：一方面通过硬编码、SetByCaller、Execution Class、MMC等不同复杂度的方式计算属性修改值（如伤害值）；另一方面通过自定义Context或Tag传递暴击、格挡、击退、Debuff等附加效果信息，最终在AttributeSet（AS）中完成这些附加效果的落地。</li>
<li><strong>实战核心流程（伤害类GE）</strong>：先将攻击方参数封装到<code>FDamageEffectParams</code>结构体，再基于该结构体填充自定义Context、构建GameplayEffectSpec（通过SetByCaller传递动态数值），接着通过Execution Class捕获源&#x2F;目标双方属性（如防御、抗性）完成复杂伤害计算（含范围伤害、Debuff概率判定），最后将GE挂载到目标ASC；Debuff作为伤害GE的附加效果，会在AS中检测到Context标记后动态创建专用GE并生效。</li>
<li><strong>关键技术要点</strong>：自定义Context需支持网络复制以跨端传递附加信息；Execution Class用于复杂数值计算（可捕获攻防双方属性），MMC作为其简化版适用于简单属性计算；GE的生效方式（瞬时&#x2F;持续&#x2F;堆叠）、Tag挂载等配置需根据场景定制，确保效果符合设计需求。</li>
</ol>
<span id="more"></span>

<h1 id="GE-的作用"><a href="#GE-的作用" class="headerlink" title="GE 的作用"></a>GE 的作用</h1><p>GE 的核心作用是对属性进行修改，同时传递属性修改附加效果的相关信息。<br>举例来说，造成伤害可视为一个典型的 GE 应用场景：其核心目标是计算出 IncomingDamage（元属性）的数值，同时将附加效果（是否格挡、是否暴击、是否击退、是否触发 Debuff 等）以上下文形式传递出去，最终让这些效果逐一生效。<br>附加效果的落地执行主要在 AS 中完成，详情见<a href="/ue5-blog/2025/12/12/GAS-AS/">此处</a>。站在 GE 的视角，核心是把需要传递的信息填充到 Context 中；若要实现击退、格挡、暴击、范围伤害等定制化效果，则需要自定义 Context 来承载这些信息。<br>除 Context 外，Tag 也是承载信息的重要方式，因此掌握向 GE 中添加 Tag 信息的方法同样关键。</p>
<p>另一个核心要点是数值计算——即确定 GE 最终修改属性的具体数值。以伤害计算为例：</p>
<ul>
<li>简单场景：直接硬编码数值、从 CurveTable 读取数值，或基于已有 Attribute 计算；</li>
<li>灵活场景：通过 Set by Caller Magnitude 动态传递数值；</li>
<li>复杂场景：需动态捕获目标防御值等数据时，要借助 Execution Class 实现。</li>
</ul>
<p>此外，GE 的作用方式也需提前定义，比如是瞬时作用还是持续作用、持续作用的周期、是否允许堆叠等，这些都要在制作 GE 时配置完成。</p>
<p>下文以“带有 Debuff 效果，且需兼顾 CriticalHit、Block、Knockback、RadialDamage 的伤害 GE”为例，逐步拆解伤害产生的完整流程。</p>
<h1 id="实战解析-Damage"><a href="#实战解析-Damage" class="headerlink" title="实战解析 Damage"></a>实战解析 Damage</h1><h2 id="1-封装伤害参数（FDamageEffectParams）"><a href="#1-封装伤害参数（FDamageEffectParams）" class="headerlink" title="1. 封装伤害参数（FDamageEffectParams）"></a>1. 封装伤害参数（FDamageEffectParams）</h2><p>所有能造成伤害的 GA 均继承自 GA_Damage，其核心作用是整合攻击方的参数并打包传递，主要实现两个功能：</p>
<ol>
<li>允许在具体技能 GA（如 GA_FireBolt）的 ClassDefaults 中编辑参数；</li>
<li>将 ClassDefaults 中配置的参数封装到 <code>FDamageEffectParams</code> 结构体中传递。</li>
</ol>
<p>该自定义结构体可包含如下内容：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">USTRUCT</span>(BlueprintType)</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FDamageEffectParams</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">GENERATED_BODY</span>()</span><br><span class="line"></span><br><span class="line">	<span class="built_in">FDamageEffectParams</span>()&#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintReadWrite)</span><br><span class="line">	TObjectPtr&lt;UObject&gt; WorldContextObject = <span class="literal">nullptr</span>;</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintReadWrite)</span><br><span class="line">	TSubclassOf&lt;UGameplayEffect&gt; DamageGEClass = <span class="literal">nullptr</span>;</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintReadWrite)</span><br><span class="line">	TObjectPtr&lt;UAbilitySystemComponent&gt; SourceASC;</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintReadWrite)</span><br><span class="line">	TObjectPtr&lt;UAbilitySystemComponent&gt; TargetASC;</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintReadWrite)</span><br><span class="line">	FGameplayTag DamageType = <span class="built_in">FGameplayTag</span>();</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintReadWrite)</span><br><span class="line">	<span class="type">float</span> BaseDamage = <span class="number">0.f</span>;</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintReadWrite)</span><br><span class="line">	<span class="type">float</span> AbilityLevel = <span class="number">1.f</span>;</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintReadWrite)</span><br><span class="line">	<span class="type">float</span> DebuffChance = <span class="number">0.f</span>;</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintReadWrite)</span><br><span class="line">	<span class="type">float</span> DebuffDamage = <span class="number">0.f</span>;</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintReadWrite)</span><br><span class="line">	<span class="type">float</span> DebuffFrequency = <span class="number">0.f</span>;</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintReadWrite)</span><br><span class="line">	<span class="type">float</span> DebuffDuration = <span class="number">0.f</span>;</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintReadWrite)</span><br><span class="line">	<span class="type">float</span> DeathImpulseMagnitude = <span class="number">0.f</span>;</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintReadWrite)</span><br><span class="line">	FVector DeathImpulse = FVector::ZeroVector;</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintReadWrite)</span><br><span class="line">	<span class="type">float</span> KnockbackForceMagnitude = <span class="number">0.f</span>;</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintReadWrite)</span><br><span class="line">	<span class="type">float</span> KnockbackChance = <span class="number">0.f</span>;</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintReadWrite)</span><br><span class="line">	FVector KnockbackForce = FVector::ZeroVector;</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintReadWrite)</span><br><span class="line">	<span class="type">bool</span> bIsRadialDamage = <span class="literal">false</span>;</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintReadWrite)</span><br><span class="line">	<span class="type">float</span> RadialDamageInnerRadius = <span class="number">0.f</span>;</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintReadWrite)</span><br><span class="line">	<span class="type">float</span> RadialDamageOuterRadius = <span class="number">0.f</span>;</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintReadWrite)</span><br><span class="line">	FVector RadialDamageOrigin = FVector::ZeroVector;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">FDamageEffectParams <span class="title">UCustomDamageGameplayAbility::MakeDamageEffectParamsFromClassDefaults</span><span class="params">(AActor* TargetActor ,FVector InRadialDamageOrigin ,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">bool</span> bOverrideKnockbackDirection ,FVector KnockbackDirectionOverride ,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">bool</span> bOverrideDeathImpulse ,FVector DeathImpulseOverride ,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">bool</span> bOverridePitch ,<span class="type">float</span> PitchOverride )</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	FDamageEffectParams Params;</span><br><span class="line"></span><br><span class="line">	Params.WorldContextObject = <span class="built_in">GetAvatarActorFromActorInfo</span>();</span><br><span class="line">	Params.DamageGEClass = DamageEffectClass;</span><br><span class="line">	Params.SourceASC = <span class="built_in">GetAbilitySystemComponentFromActorInfo</span>();</span><br><span class="line">	Params.TargetASC = UAbilitySystemBlueprintLibrary::<span class="built_in">GetAbilitySystemComponent</span>(TargetActor);</span><br><span class="line">	Params.DamageType = DamageType;</span><br><span class="line">	Params.BaseDamage = Damage.<span class="built_in">GetValueAtLevel</span>(<span class="built_in">GetAbilityLevel</span>());</span><br><span class="line">	Params.AbilityLevel = <span class="built_in">GetAbilityLevel</span>();</span><br><span class="line">	Params.DebuffChance = DebuffChance;</span><br><span class="line">	Params.DebuffDamage = DebuffDamage;</span><br><span class="line">	Params.DebuffDuration = DebuffDuration;</span><br><span class="line">	Params.DebuffFrequency = DebuffFrequency;</span><br><span class="line">	Params.DeathImpulseMagnitude = DeathImpulseMagnitude;</span><br><span class="line">	Params.KnockbackForceMagnitude = KnockbackForceMagnitude;</span><br><span class="line">	Params.KnockbackChance = KnockbackChance;</span><br><span class="line"></span><br><span class="line">	<span class="type">const</span> <span class="type">bool</span> bKnockback = FMath::<span class="built_in">RandRange</span>(<span class="number">1</span> , <span class="number">100</span>) &lt; Params.KnockbackChance;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">IsValid</span>(TargetActor))</span><br><span class="line">	&#123;</span><br><span class="line">		FRotator Rotation = (TargetActor-&gt;<span class="built_in">GetActorLocation</span>() - <span class="built_in">GetAvatarActorFromActorInfo</span>()-&gt;<span class="built_in">GetActorLocation</span>()).<span class="built_in">Rotation</span>();</span><br><span class="line">		Rotation.Pitch = <span class="number">45.f</span>;</span><br><span class="line">		<span class="keyword">if</span> (bOverridePitch)</span><br><span class="line">		&#123;</span><br><span class="line">			Rotation.Pitch = PitchOverride;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">const</span> FVector ToTarget = Rotation.<span class="built_in">Vector</span>();</span><br><span class="line">		<span class="keyword">if</span> (!bOverrideKnockbackDirection)</span><br><span class="line">		&#123;</span><br><span class="line">			Params.DeathImpulse = ToTarget * Params.DeathImpulseMagnitude;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (!bOverrideDeathImpulse &amp;&amp; bKnockback)</span><br><span class="line">		&#123;</span><br><span class="line">			Params.KnockbackForce = ToTarget * Params.KnockbackForceMagnitude;	</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (bOverrideKnockbackDirection &amp;&amp; bKnockback)</span><br><span class="line">	&#123;</span><br><span class="line">		KnockbackDirectionOverride.<span class="built_in">Normalize</span>();</span><br><span class="line">		Params.KnockbackForce = KnockbackForceMagnitude * KnockbackDirectionOverride;</span><br><span class="line">		<span class="keyword">if</span> (bOverridePitch)</span><br><span class="line">		&#123;</span><br><span class="line">			FRotator KnockbackRotation = KnockbackDirectionOverride.<span class="built_in">Rotation</span>();</span><br><span class="line">			KnockbackRotation.Pitch = PitchOverride;</span><br><span class="line">			Params.KnockbackForce = KnockbackForceMagnitude * KnockbackRotation.<span class="built_in">Vector</span>();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (bOverrideDeathImpulse)</span><br><span class="line">	&#123;</span><br><span class="line">		DeathImpulseOverride.<span class="built_in">Normalize</span>();</span><br><span class="line">		Params.DeathImpulse = DeathImpulseMagnitude * DeathImpulseOverride;</span><br><span class="line">		<span class="keyword">if</span> (bOverridePitch)</span><br><span class="line">		&#123;</span><br><span class="line">			FRotator DeathImpulseRotation = DeathImpulseOverride.<span class="built_in">Rotation</span>();</span><br><span class="line">			DeathImpulseRotation.Pitch = PitchOverride;</span><br><span class="line">			Params.DeathImpulse = DeathImpulseMagnitude * DeathImpulseRotation.<span class="built_in">Vector</span>();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> (bIsRadialDamage)</span><br><span class="line">	&#123;</span><br><span class="line">		Params.bIsRadialDamage = bIsRadialDamage;</span><br><span class="line">		Params.RadialDamageInnerRadius = RadialDamageInnerRadius;</span><br><span class="line">		Params.RadialDamageOuterRadius = RadialDamageOuterRadius;</span><br><span class="line">		Params.RadialDamageOrigin = InRadialDamageOrigin;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> Params;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要注意的细节：<br>我们在 GA 中提前填写范围伤害中心、击退方向等信息，是因为 GA 中可直接获取发起者（GA 拥有者）和目标（鼠标追踪的 Actor，获取方式见<a href="">这里</a>），基于二者位置计算这些数据即可满足大部分场景需求。若需更精准的效果（如击退方向为击中瞬间的朝向），可在后续流程中覆盖 <code>FDamageEffectParams</code> 中的参数。<br>此外，该结构体仅存储攻击方数据，无法获取受击方的防御、抗性等信息。</p>
<h2 id="2-构建-GE-实例（通用函数）"><a href="#2-构建-GE-实例（通用函数）" class="headerlink" title="2. 构建 GE 实例（通用函数）"></a>2. 构建 GE 实例（通用函数）</h2><p>基于 <code>FDamageEffectParams</code> 制作 GE 实例的函数是通用逻辑，存放于 FunctionLibrary 中：</p>
<ul>
<li>近战伤害：可直接在 GA 中调用该函数；</li>
<li>远程伤害：需等到子弹击中目标时调用（覆盖 <code>FDamageEffectParams</code> 参数）。</li>
</ul>
<p>函数实现如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">FGameplayEffectContextHandle <span class="title">UCustomAbilitySystemLibrary::ApplyDamageEffect</span><span class="params">(<span class="type">const</span> FDamageEffectParams&amp; DamageEffectParams)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">const</span> FCustomGameplayTags GameplayTags = FCustomGameplayTags::<span class="built_in">Get</span>();</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// 填写GameplayEffectContext</span></span><br><span class="line">	<span class="type">const</span> AActor* SourceAvatarActor = DamageEffectParams.SourceASC-&gt;<span class="built_in">GetAvatarActor</span>();</span><br><span class="line">	FGameplayEffectContextHandle EffectContextHandle = DamageEffectParams.SourceASC-&gt;<span class="built_in">MakeEffectContext</span>();</span><br><span class="line">	EffectContextHandle.<span class="built_in">AddSourceObject</span>(SourceAvatarActor);</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">SetDeathImpulse</span>(EffectContextHandle , DamageEffectParams.DeathImpulse);</span><br><span class="line">	<span class="built_in">SetKnockbackForce</span>(EffectContextHandle , DamageEffectParams.KnockbackForce);</span><br><span class="line">	<span class="built_in">SetIsRadialDamage</span>(EffectContextHandle , DamageEffectParams.bIsRadialDamage);</span><br><span class="line">	<span class="built_in">SetRadialDamageInnerRadius</span>(EffectContextHandle , DamageEffectParams.RadialDamageInnerRadius);</span><br><span class="line">	<span class="built_in">SetRadialDamageOuterRadius</span>(EffectContextHandle , DamageEffectParams.RadialDamageOuterRadius);</span><br><span class="line">	<span class="built_in">SetRadialDamageOrigin</span>(EffectContextHandle , DamageEffectParams.RadialDamageOrigin);</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// 制作GameplayEffectSpec</span></span><br><span class="line">	FGameplayEffectSpecHandle SpecHandle = DamageEffectParams.SourceASC-&gt;<span class="built_in">MakeOutgoingSpec</span>(DamageEffectParams.DamageGEClass , DamageEffectParams.AbilityLevel , EffectContextHandle);</span><br><span class="line"></span><br><span class="line">	UAbilitySystemBlueprintLibrary::<span class="built_in">AssignTagSetByCallerMagnitude</span>(SpecHandle , DamageEffectParams.DamageType , DamageEffectParams.BaseDamage);</span><br><span class="line">	UAbilitySystemBlueprintLibrary::<span class="built_in">AssignTagSetByCallerMagnitude</span>(SpecHandle , GameplayTags.Debuff_Chance , DamageEffectParams.DebuffChance);</span><br><span class="line">	UAbilitySystemBlueprintLibrary::<span class="built_in">AssignTagSetByCallerMagnitude</span>(SpecHandle , GameplayTags.Debuff_Damage , DamageEffectParams.DebuffDamage);</span><br><span class="line">	UAbilitySystemBlueprintLibrary::<span class="built_in">AssignTagSetByCallerMagnitude</span>(SpecHandle , GameplayTags.Debuff_Duration , DamageEffectParams.DebuffDuration);</span><br><span class="line">	UAbilitySystemBlueprintLibrary::<span class="built_in">AssignTagSetByCallerMagnitude</span>(SpecHandle , GameplayTags.Debuff_Frequency , DamageEffectParams.DebuffFrequency);</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// 应用GameplayEffect到目标</span></span><br><span class="line">	DamageEffectParams.TargetASC-&gt;<span class="built_in">ApplyGameplayEffectSpecToSelf</span>(*SpecHandle.Data);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> EffectContextHandle;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该函数核心分为三步：</p>
<ol>
<li>填写 GameplayEffectContext；</li>
<li>制作 GameplayEffectSpec；</li>
<li>应用 GameplayEffect 到目标。</li>
</ol>
<p>补充说明：代码中操作的 Handle 类型对象是 UE 的弱引用设计，关于 Handle 的更多内容可参考<a href="/ue5-blog/2025/12/10/ProgrammingSkills-Pointer/">此处</a>。</p>
<h3 id="填写-GameplayEffectContext"><a href="#填写-GameplayEffectContext" class="headerlink" title="填写 GameplayEffectContext"></a>填写 GameplayEffectContext</h3><p>步骤如下：</p>
<ol>
<li>调用 <code>MakeEffectContext</code> 创建新上下文，通过 <code>AddSourceObject</code> 填入 GE 发起者（易遗漏，编译时会报错提醒）；</li>
<li>自定义上下文需类型转换，因此 Set 类函数均包含 Cast 操作：</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">UCustomAbilitySystemLibrary::SetDeathImpulse</span><span class="params">(FGameplayEffectContextHandle&amp; EffectContextHandle,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> FVector&amp; InDeathImpulse)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (FCustomGameplayEffectContext* CustomContext = <span class="built_in">static_cast</span>&lt;FCustomGameplayEffectContext*&gt;(EffectContextHandle.<span class="built_in">Get</span>()))</span><br><span class="line">	&#123;</span><br><span class="line">		CustomContext-&gt;<span class="built_in">SetDeathImpulse</span>(InDeathImpulse);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>自定义上下文需支持网络复制，为参数配置 Setter&#x2F;Getter 保证安全易用：</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">USTRUCT</span>(BlueprintType)</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FCustomGameplayEffectContext</span> : <span class="keyword">public</span> FGameplayEffectContext</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">GENERATED_BODY</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">IsBlockedHit</span><span class="params">()</span> <span class="type">const</span> </span>&#123;<span class="keyword">return</span> bIsBlockedHit;&#125;</span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">IsCriticalHit</span><span class="params">()</span> <span class="type">const</span> </span>&#123;<span class="keyword">return</span> bIsCriticalHit;&#125;</span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">IsSuccessfulDebuff</span><span class="params">()</span> <span class="type">const</span> </span>&#123;<span class="keyword">return</span> bIsSuccessfulDebuff;&#125;</span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">IsRadialDamage</span><span class="params">()</span> <span class="type">const</span> </span>&#123;<span class="keyword">return</span> bIsRadialDamage;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">float</span> <span class="title">GetDebuffDamage</span><span class="params">()</span> <span class="type">const</span> </span>&#123;<span class="keyword">return</span> DebuffDamage;&#125;</span><br><span class="line">	<span class="function"><span class="type">float</span> <span class="title">GetDebuffFrequency</span><span class="params">()</span> <span class="type">const</span> </span>&#123;<span class="keyword">return</span> DebuffFrequency;&#125;</span><br><span class="line">	<span class="function"><span class="type">float</span> <span class="title">GetDebuffDuration</span><span class="params">()</span> <span class="type">const</span> </span>&#123;<span class="keyword">return</span> DebuffDuration;&#125;</span><br><span class="line">	<span class="function"><span class="type">float</span> <span class="title">GetRadialDamageInnerRadius</span><span class="params">()</span> <span class="type">const</span> </span>&#123;<span class="keyword">return</span> RadialDamageInnerRadius;&#125;</span><br><span class="line">	<span class="function"><span class="type">float</span> <span class="title">GetRadialDamageOuterRadius</span><span class="params">()</span> <span class="type">const</span> </span>&#123;<span class="keyword">return</span> RadialDamageOuterRadius;&#125;</span><br><span class="line">	<span class="function">TSharedPtr&lt;FGameplayTag&gt; <span class="title">GetDamageType</span><span class="params">()</span> <span class="type">const</span> </span>&#123;<span class="keyword">return</span> DamageType;&#125;</span><br><span class="line">	<span class="function">FVector <span class="title">GetDeathImpulse</span><span class="params">()</span> <span class="type">const</span> </span>&#123;<span class="keyword">return</span> DeathImpulse;&#125;</span><br><span class="line">	<span class="function">FVector <span class="title">GetKnockbackForce</span><span class="params">()</span> <span class="type">const</span> </span>&#123;<span class="keyword">return</span> KnockbackForce;&#125;</span><br><span class="line">	<span class="function">FVector <span class="title">GetRadialDamageOrigin</span><span class="params">()</span> <span class="type">const</span> </span>&#123;<span class="keyword">return</span> RadialDamageOrigin;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">SetBlockedHit</span><span class="params">(<span class="type">bool</span> bInIsBlockedHit)</span> </span>&#123;bIsBlockedHit = bInIsBlockedHit;&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">SetCriticalHit</span><span class="params">(<span class="type">bool</span> bInIsCriticalHit)</span> </span>&#123;bIsCriticalHit = bInIsCriticalHit;&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">SetSuccessfulDebuff</span><span class="params">(<span class="type">bool</span> bInIsSuccessfulDebuff)</span></span>&#123; bIsSuccessfulDebuff = bInIsSuccessfulDebuff;&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">SetRadialDamage</span><span class="params">(<span class="type">bool</span> bInIsRadialDamage)</span></span>&#123;bIsRadialDamage = bInIsRadialDamage;&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">SetDebuffDamage</span><span class="params">(<span class="type">float</span> InDebuffDamage)</span> </span>&#123; DebuffDamage = InDebuffDamage;&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">SetDebuffDuration</span><span class="params">(<span class="type">float</span> InDebuffDuration)</span> </span>&#123; DebuffDuration = InDebuffDuration;&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">SetDebuffFrequency</span><span class="params">(<span class="type">float</span> InDebuffFrequency)</span></span>&#123; DebuffFrequency = InDebuffFrequency;&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">SetRadialDamageInnerRadius</span><span class="params">(<span class="type">float</span> InInnerRadius)</span></span>&#123;RadialDamageInnerRadius = InInnerRadius;&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">SetRadialDamageOuterRadius</span><span class="params">(<span class="type">float</span> InOuterRadius)</span></span>&#123;RadialDamageOuterRadius = InOuterRadius;&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">SetDamageType</span><span class="params">(TSharedPtr&lt;FGameplayTag&gt; InDamageType)</span> </span>&#123; DamageType = InDamageType; &#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">SetDeathImpulse</span><span class="params">(<span class="type">const</span> FVector&amp; InImpulse)</span> </span>&#123; DeathImpulse = InImpulse; &#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">SetKnockbackForce</span><span class="params">(<span class="type">const</span> FVector&amp; InForce)</span> </span>&#123; KnockbackForce = InForce; &#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">SetRadialDamageOrigin</span><span class="params">(<span class="type">const</span> FVector&amp; InOrigin)</span> </span>&#123; RadialDamageOrigin = InOrigin; &#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> UScriptStruct* <span class="title">GetScriptStruct</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">StaticStruct</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> FCustomGameplayEffectContext* <span class="title">Duplicate</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		FCustomGameplayEffectContext* NewContext = <span class="keyword">new</span> <span class="built_in">FCustomGameplayEffectContext</span>();</span><br><span class="line">		*NewContext = *<span class="keyword">this</span>;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">GetHitResult</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			NewContext-&gt;<span class="built_in">AddHitResult</span>(*<span class="built_in">GetHitResult</span>(), <span class="literal">true</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> NewContext;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">NetSerialize</span><span class="params">(FArchive&amp; Ar, <span class="keyword">class</span> UPackageMap* Map, <span class="type">bool</span>&amp; bOutSuccess)</span> <span class="keyword">override</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	<span class="type">bool</span> bIsBlockedHit = <span class="literal">false</span>;</span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	<span class="type">bool</span> bIsCriticalHit = <span class="literal">false</span>;</span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	<span class="type">bool</span> bIsSuccessfulDebuff = <span class="literal">false</span>;</span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	<span class="type">float</span> DebuffDamage = <span class="number">0.f</span>;</span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	<span class="type">float</span> DebuffFrequency = <span class="number">0.f</span>;</span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	<span class="type">float</span> DebuffDuration = <span class="number">0.f</span>;</span><br><span class="line">	TSharedPtr&lt;FGameplayTag&gt; DamageType;</span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	FVector DeathImpulse = FVector::ZeroVector;</span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	FVector KnockbackForce = FVector::ZeroVector;</span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	<span class="type">bool</span> bIsRadialDamage = <span class="literal">false</span>;</span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	<span class="type">float</span> RadialDamageInnerRadius = <span class="number">0.f</span>;</span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	<span class="type">float</span> RadialDamageOuterRadius = <span class="number">0.f</span>;</span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	FVector RadialDamageOrigin = FVector::ZeroVector;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TStructOpsTypeTraits</span>&lt;FCustomGameplayEffectContext&gt; : <span class="keyword">public</span> TStructOpsTypeTraitsBase2&lt;FCustomGameplayEffectContext&gt;</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">enum</span></span><br><span class="line">	&#123;</span><br><span class="line">		WithNetSerializer = <span class="literal">true</span>,</span><br><span class="line">		WithCopy = <span class="literal">true</span></span><br><span class="line">	&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>使用自定义Context还需要完成如下步骤：</p>
<ul>
<li><ol>
<li>创建自定义Globals类，并重写函数<code>AllocGameplayEffectContext</code></li>
</ol>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UCLASS</span>()</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GAS_Custom_API</span> UCustomAbilitySystemGlobals : <span class="keyword">public</span> UAbilitySystemGlobals</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">GENERATED_BODY</span>()</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> FGameplayEffectContext* <span class="title">AllocGameplayEffectContext</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span>;</span><br><span class="line">	</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">FGameplayEffectContext* <span class="title">UCustomAbilitySystemGlobals::AllocGameplayEffectContext</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">FCustomGameplayEffectContext</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><ol start="2">
<li>更改配置，使用自定义Context<br>修改Config&#x2F;DefaultGame.ini文件，添加如下内容：</li>
</ol>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[/Script/GameplayAbilities.AbilitySystemGlobals]</span><br><span class="line">+AbilitySystemGlobalsClassName=&quot;Script/ProjectName.CustomeAbilitySystemGlobals&quot;</span><br></pre></td></tr></table></figure>

<h3 id="制作-GameplayEffectSpec"><a href="#制作-GameplayEffectSpec" class="headerlink" title="制作 GameplayEffectSpec"></a>制作 GameplayEffectSpec</h3><p>调用 <code>MakeOutgoingSpec</code> 制作 Spec，需传入 GE 模板类、等级和上下文信息。Spec 是控制 GE 实例化的核心，应用 Spec 即表示将 GE 实例挂载到目标 ASC 上。</p>
<p>核心问题是确定 GE 修改的属性数值（如伤害值）：</p>
<ol>
<li>数据传递：攻击方攻击力已封装在 EffectParams 中，但未传入 Context（Context 主要传递 GE 后续影响，攻击力仅影响 GE 最终修改的属性值）；</li>
<li>Debuff 数据处理：虽自定义 Context 包含 Debuff 数据，但暂不传递，原因是：<ul>
<li>Debuff 是概率事件，未触发时无需序列化，可优化性能；</li>
<li>Debuff 需结合受击方抗性计算，此时仅能获取攻击方数据，传递时机过早。</li>
</ul>
</li>
</ol>
<p>因此需通过 SetByCaller 将 EffectParams 数据传入 EffectSpec——Spec 内部维护 Tag 到数值的映射表，存取方式如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 绑定数据到Tag</span></span><br><span class="line">UAbilitySystemBlueprintLibrary::<span class="built_in">AssignTagSetByCallerMagnitude</span>(SpecHandle , DamageEffectParams.DamageType , DamageEffectParams.BaseDamage);</span><br><span class="line"><span class="comment">// 从Tag读取数据（后两个参数：未找到标签是否警告、未找到时返回值）</span></span><br><span class="line"><span class="type">const</span> <span class="type">float</span> TypeDamage = Spec.<span class="built_in">GetSetByCallerMagnitude</span>(DamageType , <span class="literal">false</span> , <span class="number">-1.f</span>);</span><br></pre></td></tr></table></figure>

<p>其中 DamageType 标签用于区分攻击类型（如火攻、雷攻）。</p>
<h3 id="应用-GameplayEffect-到目标"><a href="#应用-GameplayEffect-到目标" class="headerlink" title="应用 GameplayEffect 到目标"></a>应用 GameplayEffect 到目标</h3><p>代码中调用 <code>TargetASC-&gt;ApplyGameplayEffectSpecToSelf</code> 看似直接应用 GE，但核心的伤害计算封装在底层——GE 最终挂载在目标 ASC 上，EffectSpec 已包含上下文和 SetByCaller 数据，足以支撑计算。</p>
<p>GE 模板类（如 GE_Damage）需定义以下核心要素：</p>
<ol>
<li>Duration Policy：分为 Instant（瞬时）、Infinite（永久）、Duration（持续），暂不考虑持续伤害（归为 Debuff 处理）；</li>
<li>Modifier：简单数值计算（硬编码&#x2F;ScalableFloat），Debuff 的 GE 会用到；</li>
<li>Execution：复杂数值计算（捕获属性、定制化逻辑），需在蓝图中添加继承自 <code>UGameplayEffectExecutionCalculation</code> 的自定义类型；</li>
<li>Component：挂载 Tag，Debuff 的 GE 会用到；</li>
<li>Stacking：叠加策略，简化场景下选 None 即可。</li>
</ol>
<h4 id="Exec-Damage-定制化计算"><a href="#Exec-Damage-定制化计算" class="headerlink" title="Exec_Damage 定制化计算"></a>Exec_Damage 定制化计算</h4><p>核心是重写 <code>Execute_Implementation</code> 函数，步骤如下：</p>
<h5 id="步骤1：定义并注册属性捕获规则"><a href="#步骤1：定义并注册属性捕获规则" class="headerlink" title="步骤1：定义并注册属性捕获规则"></a>步骤1：定义并注册属性捕获规则</h5><p>通过静态函数封装规则避免重复注册，规则格式：<code>DEFINE_ATTRIBUTE_CAPTUREDEF(AS类 , 属性名 , 捕获源（Source/Target） , 是否快照)</code>。是否快照一般选 false，防止参数变化影响计算。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">CustomDamageStatics</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">DECLARE_ATTRIBUTE_CAPTUREDEF</span>(Armor);</span><br><span class="line">	<span class="built_in">DECLARE_ATTRIBUTE_CAPTUREDEF</span>(ArmorPenetration);</span><br><span class="line">	<span class="built_in">DECLARE_ATTRIBUTE_CAPTUREDEF</span>(BlockChance);</span><br><span class="line">	<span class="built_in">DECLARE_ATTRIBUTE_CAPTUREDEF</span>(CriticalHitChance);</span><br><span class="line">	<span class="built_in">DECLARE_ATTRIBUTE_CAPTUREDEF</span>(CriticalHitDamage);</span><br><span class="line">	<span class="built_in">DECLARE_ATTRIBUTE_CAPTUREDEF</span>(CriticalHitResistance);</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">DECLARE_ATTRIBUTE_CAPTUREDEF</span>(FireResistance);</span><br><span class="line">	<span class="built_in">DECLARE_ATTRIBUTE_CAPTUREDEF</span>(LightningResistance);</span><br><span class="line">	<span class="built_in">DECLARE_ATTRIBUTE_CAPTUREDEF</span>(ArcaneResistance);</span><br><span class="line">	<span class="built_in">DECLARE_ATTRIBUTE_CAPTUREDEF</span>(PhysicalResistance);</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">CustomDamageStatics</span>()</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">DEFINE_ATTRIBUTE_CAPTUREDEF</span>(UCustomAttributeSet , Armor , Target , <span class="literal">false</span>);</span><br><span class="line">		<span class="built_in">DEFINE_ATTRIBUTE_CAPTUREDEF</span>(UCustomAttributeSet , ArmorPenetration , Source , <span class="literal">false</span>);</span><br><span class="line">		<span class="built_in">DEFINE_ATTRIBUTE_CAPTUREDEF</span>(UCustomAttributeSet , BlockChance , Target , <span class="literal">false</span>);</span><br><span class="line">		<span class="built_in">DEFINE_ATTRIBUTE_CAPTUREDEF</span>(UCustomAttributeSet , CriticalHitChance , Source , <span class="literal">false</span>);</span><br><span class="line">		<span class="built_in">DEFINE_ATTRIBUTE_CAPTUREDEF</span>(UCustomAttributeSet , CriticalHitDamage , Source , <span class="literal">false</span>);</span><br><span class="line">		<span class="built_in">DEFINE_ATTRIBUTE_CAPTUREDEF</span>(UCustomAttributeSet , CriticalHitResistance , Target , <span class="literal">false</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="built_in">DEFINE_ATTRIBUTE_CAPTUREDEF</span>(UCustomAttributeSet , FireResistance , Target , <span class="literal">false</span>);</span><br><span class="line">		<span class="built_in">DEFINE_ATTRIBUTE_CAPTUREDEF</span>(UCustomAttributeSet , LightningResistance , Target , <span class="literal">false</span>);</span><br><span class="line">		<span class="built_in">DEFINE_ATTRIBUTE_CAPTUREDEF</span>(UCustomAttributeSet , ArcaneResistance , Target , <span class="literal">false</span>);</span><br><span class="line">		<span class="built_in">DEFINE_ATTRIBUTE_CAPTUREDEF</span>(UCustomAttributeSet , PhysicalResistance , Target , <span class="literal">false</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">const</span> CustomDamageStatics&amp; <span class="title">DamageStatics</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">static</span> CustomDamageStatics  DStatics;</span><br><span class="line">	<span class="keyword">return</span> DStatics;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="步骤2：注册捕获规则"><a href="#步骤2：注册捕获规则" class="headerlink" title="步骤2：注册捕获规则"></a>步骤2：注册捕获规则</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">UExecCalc_Damage::<span class="built_in">UExecCalc_Damage</span>()</span><br><span class="line">&#123;</span><br><span class="line">	RelevantAttributesToCapture.<span class="built_in">Add</span>(<span class="built_in">DamageStatics</span>().ArmorDef);</span><br><span class="line">	RelevantAttributesToCapture.<span class="built_in">Add</span>(<span class="built_in">DamageStatics</span>().ArmorPenetrationDef);</span><br><span class="line">	RelevantAttributesToCapture.<span class="built_in">Add</span>(<span class="built_in">DamageStatics</span>().BlockChanceDef);</span><br><span class="line">	RelevantAttributesToCapture.<span class="built_in">Add</span>(<span class="built_in">DamageStatics</span>().CriticalHitChanceDef);</span><br><span class="line">	RelevantAttributesToCapture.<span class="built_in">Add</span>(<span class="built_in">DamageStatics</span>().CriticalHitDamageDef);</span><br><span class="line">	RelevantAttributesToCapture.<span class="built_in">Add</span>(<span class="built_in">DamageStatics</span>().CriticalHitResistanceDef);</span><br><span class="line">	</span><br><span class="line">	RelevantAttributesToCapture.<span class="built_in">Add</span>(<span class="built_in">DamageStatics</span>().FireResistanceDef);</span><br><span class="line">	RelevantAttributesToCapture.<span class="built_in">Add</span>(<span class="built_in">DamageStatics</span>().LightningResistanceDef);</span><br><span class="line">	RelevantAttributesToCapture.<span class="built_in">Add</span>(<span class="built_in">DamageStatics</span>().ArcaneResistanceDef);</span><br><span class="line">	RelevantAttributesToCapture.<span class="built_in">Add</span>(<span class="built_in">DamageStatics</span>().PhysicalResistanceDef);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="步骤3：使用捕获属性计算伤害"><a href="#步骤3：使用捕获属性计算伤害" class="headerlink" title="步骤3：使用捕获属性计算伤害"></a>步骤3：使用捕获属性计算伤害</h5><p>先准备 EvaluateParams 和 Context，再调用 <code>AttemptCalculateCapturedAttributeMagnitude</code> 获取属性值，同时将是否暴击等信息写入 Context（引用传递可直接修改）：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> FGameplayEffectSpec&amp; Spec = ExecutionParams.<span class="built_in">GetOwningSpec</span>();</span><br><span class="line">FGameplayEffectContextHandle EffectContextHandle = Spec.<span class="built_in">GetContext</span>();</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> FGameplayTagContainer* SourceTags = Spec.CapturedSourceTags.<span class="built_in">GetAggregatedTags</span>();</span><br><span class="line"><span class="type">const</span> FGameplayTagContainer* TargetTags = Spec.CapturedTargetTags.<span class="built_in">GetAggregatedTags</span>();</span><br><span class="line">FAggregatorEvaluateParameters EvaluateParameters;</span><br><span class="line">EvaluateParameters.SourceTags = SourceTags;</span><br><span class="line">EvaluateParameters.TargetTags = TargetTags;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> TargetBlockChance = <span class="number">0.f</span>;</span><br><span class="line">ExecutionParams.<span class="built_in">AttemptCalculateCapturedAttributeMagnitude</span>(<span class="built_in">DamageStatics</span>().BlockChanceDef , EvaluateParameters , TargetBlockChance);</span><br><span class="line">TargetBlockChance = FMath::<span class="built_in">Max</span>&lt;<span class="type">float</span>&gt;(TargetBlockChance, <span class="number">0.f</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">bool</span> bBlocked = FMath::<span class="built_in">RandRange</span>(<span class="number">1</span> , <span class="number">100</span>) &lt; TargetBlockChance;</span><br><span class="line">UCustomAbilitySystemLibrary::<span class="built_in">SetIsBlockedHit</span>(EffectContextHandle , bBlocked);</span><br><span class="line"></span><br><span class="line">Damage = bBlocked ? Damage / <span class="number">2.f</span> : Damage;</span><br></pre></td></tr></table></figure>

<h4 id="RadialDamage-范围伤害实现"><a href="#RadialDamage-范围伤害实现" class="headerlink" title="RadialDamage 范围伤害实现"></a>RadialDamage 范围伤害实现</h4><p>实现步骤：</p>
<ol>
<li>计算完抗性减免后的伤害值 DamageTypeValue；</li>
<li>调用 <code>UGameplayStatics::ApplyRadialDamageWithFalloff</code> 计算范围伤害；</li>
<li>该函数会触发角色类 <code>TakeDamage</code>，需在 <code>TakeDamage</code> 中广播伤害值，再绑定回调获取并覆盖 DamageTypeValue。</li>
</ol>
<p>逻辑需注意：先绑定回调再广播，才能正确捕获数值：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (UCustomAbilitySystemLibrary::<span class="built_in">IsRadialDamage</span>(EffectContextHandle))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (ICombatInterface* CombatInterface = <span class="built_in">Cast</span>&lt;ICombatInterface&gt;(TargetAvatar))</span><br><span class="line">    &#123;</span><br><span class="line">        CombatInterface-&gt;<span class="built_in">GetOnDamageDelegate</span>().<span class="built_in">AddLambda</span>(</span><br><span class="line">            [&amp;](<span class="type">float</span> DamageAmount)</span><br><span class="line">            &#123;</span><br><span class="line">                DamageTypeValue = DamageAmount;</span><br><span class="line">            &#125;</span><br><span class="line">            );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    UGameplayStatics::<span class="built_in">ApplyRadialDamageWithFalloff</span>(</span><br><span class="line">        TargetAvatar ,</span><br><span class="line">        DamageTypeValue ,</span><br><span class="line">        <span class="number">0.f</span> ,</span><br><span class="line">        UCustomAbilitySystemLibrary::<span class="built_in">GetRadialDamageOrigin</span>(EffectContextHandle) ,</span><br><span class="line">        UCustomAbilitySystemLibrary::<span class="built_in">GetRadialDamageInnerRadius</span>(EffectContextHandle) ,</span><br><span class="line">        UCustomAbilitySystemLibrary::<span class="built_in">GetRadialDamageOuterRadius</span>(EffectContextHandle) ,</span><br><span class="line">        <span class="number">1.f</span> ,</span><br><span class="line">        UDamageType::<span class="built_in">StaticClass</span>() ,</span><br><span class="line">        <span class="built_in">TArray</span>&lt;AActor*&gt;() ,</span><br><span class="line">        SourceAvatar ,</span><br><span class="line">        <span class="literal">nullptr</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>补充说明：该方式逻辑稍绕，但无需关注范围伤害细节；也可基于 Context 中的范围伤害原点、目标位置自定义算法实现。</p>
<h4 id="Debuff-处理"><a href="#Debuff-处理" class="headerlink" title="Debuff 处理"></a>Debuff 处理</h4><p>Debuff 是伤害 GE 的附加作用，核心是填充 Context（在 Execution 中计算是因为需结合受击方抗性，而非仅用攻击方数据）：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">float</span> TypeDamage = Spec.<span class="built_in">GetSetByCallerMagnitude</span>(DamageType , <span class="literal">false</span> , <span class="number">-1.f</span>);</span><br><span class="line"><span class="keyword">if</span> (TypeDamage &gt; <span class="number">-1.f</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> SourceDebuffChance = Spec.<span class="built_in">GetSetByCallerMagnitude</span>(GameplayTags.Debuff_Chance , <span class="literal">false</span> , <span class="number">-1.f</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> TargetDebuffResistance = <span class="number">0.f</span>;</span><br><span class="line">    <span class="type">const</span> FGameplayTag&amp; ResistanceTag = GameplayTags.DamageTypesToResistances[DamageType];</span><br><span class="line">    ExecutionParams.<span class="built_in">AttemptCalculateCapturedAttributeMagnitude</span>(InTagsToDefs[ResistanceTag] , EvaluateParameters , TargetDebuffResistance);</span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> EffectiveDebuffChance = SourceDebuffChance * (<span class="number">100.f</span> - TargetDebuffResistance) / <span class="number">100.f</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">bool</span> bDebuff = FMath::<span class="built_in">RandRange</span>(<span class="number">1</span> , <span class="number">100</span>) &lt; EffectiveDebuffChance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (bDebuff)</span><br><span class="line">    &#123;</span><br><span class="line">        FGameplayEffectContextHandle ContextHandle = Spec.<span class="built_in">GetContext</span>();</span><br><span class="line"></span><br><span class="line">        UCustomAbilitySystemLibrary::<span class="built_in">SetIsSuccessfulDebuff</span>(ContextHandle , <span class="literal">true</span>);</span><br><span class="line">        UCustomAbilitySystemLibrary::<span class="built_in">SetDamageType</span>(ContextHandle , DamageType);</span><br><span class="line"></span><br><span class="line">        <span class="type">const</span> <span class="type">float</span> DebuffDamage = Spec.<span class="built_in">GetSetByCallerMagnitude</span>(GameplayTags.Debuff_Damage , <span class="literal">false</span> , <span class="number">-1.f</span>);</span><br><span class="line">        <span class="type">const</span> <span class="type">float</span> DebuffDuration = Spec.<span class="built_in">GetSetByCallerMagnitude</span>(GameplayTags.Debuff_Duration, <span class="literal">false</span> , <span class="number">-1.f</span>);</span><br><span class="line">        <span class="type">const</span> <span class="type">float</span> DebuffFrequency = Spec.<span class="built_in">GetSetByCallerMagnitude</span>(GameplayTags.Debuff_Frequency , <span class="literal">false</span> , <span class="number">-1.f</span>);</span><br><span class="line"></span><br><span class="line">        UCustomAbilitySystemLibrary::<span class="built_in">SetDebuffDamage</span>(ContextHandle , DebuffDamage);</span><br><span class="line">        UCustomAbilitySystemLibrary::<span class="built_in">SetDebuffDuration</span>(ContextHandle , DebuffDuration);</span><br><span class="line">        UCustomAbilitySystemLibrary::<span class="built_in">SetDebuffFrequency</span>(ContextHandle , DebuffFrequency);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：DamageType 是预定义的伤害类型 Tag，若 <code>AssignTagSetByCallerMagnitude</code> 未注册对应 Tag，读取会返回 -1.f。</p>
<h1 id="Debuff的生效"><a href="#Debuff的生效" class="headerlink" title="Debuff的生效"></a>Debuff的生效</h1><p>GE_Damage 最终传递到目标 AS（修改元属性 IncomingDamage，原因见<a href="/ue5-blog/2025/12/12/GAS-AS/">此处</a>），传递的不仅是属性数值，还有完整的 GE Context——AS 会基于 Context 处理 Debuff 等附加效果。</p>
<p>AS 中检测到 Context 标记 <code>IsSuccessfulDebuff</code> 为 true 时，调用 <code>HandleDebuff</code> 处理：Debuff 本质是新的 GE（无需复用 GE_Damage，避免冗余的击退、暴击逻辑），需动态创建并挂载到目标 ASC。</p>
<p>具体步骤：</p>
<ol>
<li>制作 Context，填入 <code>AddSourceObject</code>；</li>
<li>新建 GE 实例：<code>NewObject&lt;UGameplayEffect&gt;(GetTransientPackage() , FName(DebuffName))</code>（Outer 参数用 <code>GetTransientPackage()</code>）；</li>
<li>配置 Duration Policy（使用 Context 传递的数值，数据已整理到 Props 结构体，见<a href="/ue5-blog/2025/12/12/GAS-AS/">此处</a>）；</li>
<li>添加 Tag（示例：眩晕 Debuff 屏蔽玩家输入）；</li>
<li>设置堆叠规则（限制叠加重数）；</li>
<li>添加 Modifier（用简单的 FScalableFloat 类型）；</li>
<li>应用新建的 GE。</li>
</ol>
<p>代码实现：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">UCustomAttributeSet::HandleDebuff</span><span class="params">(<span class="type">const</span> FEffectProperties&amp; Props)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">const</span> FCustomGameplayTags GameplayTags = FCustomGameplayTags::<span class="built_in">Get</span>();</span><br><span class="line">	</span><br><span class="line">	FGameplayEffectContextHandle EffectContext = Props.SourceASC-&gt;<span class="built_in">MakeEffectContext</span>();</span><br><span class="line">	EffectContext.<span class="built_in">AddSourceObject</span>(Props.SourceAvatarActor);</span><br><span class="line"></span><br><span class="line">	<span class="type">const</span> FGameplayTag DamageType = UCustomAbilitySystemLibrary::<span class="built_in">GetDamageType</span>(Props.EffectContextHandle);</span><br><span class="line">	<span class="type">const</span> <span class="type">float</span> DebuffDamage = UCustomAbilitySystemLibrary::<span class="built_in">GetDebuffDamage</span>(Props.EffectContextHandle);</span><br><span class="line">	<span class="type">const</span> <span class="type">float</span> DebuffDuration = UCustomAbilitySystemLibrary::<span class="built_in">GetDebuffDuration</span>(Props.EffectContextHandle);</span><br><span class="line">	<span class="type">const</span> <span class="type">float</span> DebuffFrequency = UCustomAbilitySystemLibrary::<span class="built_in">GetDebuffFrequency</span>(Props.EffectContextHandle);</span><br><span class="line">	</span><br><span class="line">	FString DebuffName = FString::<span class="built_in">Printf</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;DynamicDebuff_%s&quot;</span>) , *DamageType.<span class="built_in">ToString</span>() );</span><br><span class="line">	UGameplayEffect* Effect = <span class="built_in">NewObject</span>&lt;UGameplayEffect&gt;(<span class="built_in">GetTransientPackage</span>() , <span class="built_in">FName</span>(DebuffName));</span><br><span class="line"></span><br><span class="line">	Effect-&gt;DurationPolicy = EGameplayEffectDurationType::HasDuration;</span><br><span class="line">	Effect-&gt;Period = DebuffFrequency;</span><br><span class="line">	Effect-&gt;DurationMagnitude = <span class="built_in">FScalableFloat</span>(DebuffDuration);</span><br><span class="line"></span><br><span class="line">	<span class="type">const</span> FGameplayTag DebuffTag = GameplayTags.DamageTypesToDebuffs[DamageType];</span><br><span class="line">	FInheritedTagContainer TagContainer = <span class="built_in">FInheritedTagContainer</span>();</span><br><span class="line">	UTargetTagsGameplayEffectComponent&amp; Component = Effect-&gt;<span class="built_in">FindOrAddComponent</span>&lt;UTargetTagsGameplayEffectComponent&gt;();</span><br><span class="line">	TagContainer.Added.<span class="built_in">AddTag</span>(DebuffTag);</span><br><span class="line">	<span class="keyword">if</span> (DebuffTag.<span class="built_in">MatchesTagExact</span>(GameplayTags.Debuff_Stun))</span><br><span class="line">	&#123;</span><br><span class="line">		TagContainer.Added.<span class="built_in">AddTag</span>(GameplayTags.Player_Block_InputHeld);</span><br><span class="line">		TagContainer.Added.<span class="built_in">AddTag</span>(GameplayTags.Player_Block_CursorTrace);</span><br><span class="line">		TagContainer.Added.<span class="built_in">AddTag</span>(GameplayTags.Player_Block_InputPressed);</span><br><span class="line">		TagContainer.Added.<span class="built_in">AddTag</span>(GameplayTags.Player_Block_InputReleased);</span><br><span class="line">	&#125;</span><br><span class="line">	Component.<span class="built_in">SetAndApplyTargetTagChanges</span>(TagContainer);</span><br><span class="line"></span><br><span class="line">	Effect-&gt;StackingType = EGameplayEffectStackingType::AggregateBySource;</span><br><span class="line">	Effect-&gt;StackLimitCount = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="type">const</span> int32 Index = Effect-&gt;Modifiers.<span class="built_in">Num</span>();</span><br><span class="line">	Effect-&gt;Modifiers.<span class="built_in">Add</span>(<span class="built_in">FGameplayModifierInfo</span>());</span><br><span class="line">	FGameplayModifierInfo&amp; ModifierInfo = Effect-&gt;Modifiers[Index];</span><br><span class="line"></span><br><span class="line">	ModifierInfo.ModifierMagnitude = <span class="built_in">FScalableFloat</span>(DebuffDamage);</span><br><span class="line">	ModifierInfo.ModifierOp = EGameplayModOp::Additive;</span><br><span class="line">	ModifierInfo.Attribute = UCustomAttributeSet::<span class="built_in">GetIncomingDamageAttribute</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (FGameplayEffectSpec* MutableSpec = <span class="keyword">new</span> <span class="built_in">FGameplayEffectSpec</span>(Effect , EffectContext , <span class="number">1.f</span>))</span><br><span class="line">	&#123;</span><br><span class="line">		FCustomGameplayEffectContext* CustomContext = <span class="built_in">static_cast</span>&lt;FCustomGameplayEffectContext*&gt;(MutableSpec-&gt;<span class="built_in">GetContext</span>().<span class="built_in">Get</span>());</span><br><span class="line">		TSharedPtr&lt;FGameplayTag&gt; DebuffDamageType = <span class="built_in">MakeShareable</span>(<span class="keyword">new</span> <span class="built_in">FGameplayTag</span>(DamageType));</span><br><span class="line">		CustomContext-&gt;<span class="built_in">SetDamageType</span>(DebuffDamageType);</span><br><span class="line">		Props.TargetASC-&gt;<span class="built_in">ApplyGameplayEffectSpecToSelf</span>(*MutableSpec);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ModMagCalc-MMC"><a href="#ModMagCalc-MMC" class="headerlink" title="ModMagCalc (MMC)"></a>ModMagCalc (MMC)</h1><p>补充一种 GE 数值计算方式：在 Modifier 中选择 MMC 并自定义类型，是 Execution 的弱化版，仅需完成以下步骤：</p>
<ol>
<li>定义捕获属性，在构造函数中注册；</li>
<li>重写 <code>CalculateBaseMagnitude_Implementation</code> 返回计算结果；</li>
<li>计算前准备 EvaluateParams，调用 <code>GetCapturedAttributeMagnitude</code> 获取属性值；</li>
<li>基于获取的数据完成计算并返回。</li>
</ol>
<p>声明与实现：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UCLASS</span>()</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GAS_Custom_API</span> UMMC_MaxHealth : <span class="keyword">public</span> UGameplayModMagnitudeCalculation</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">GENERATED_BODY</span>()</span><br><span class="line">	</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">UMMC_MaxHealth</span>();</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">float</span> <span class="title">CalculateBaseMagnitude_Implementation</span><span class="params">(<span class="type">const</span> FGameplayEffectSpec&amp; Spec)</span> <span class="type">const</span> <span class="keyword">override</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	FGameplayEffectAttributeCaptureDefinition VigorDef;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">UMMC_MaxHealth::<span class="built_in">UMMC_MaxHealth</span>()</span><br><span class="line">&#123;</span><br><span class="line">	VigorDef.AttributeToCapture = UCustomAttributeSet::<span class="built_in">GetVigorAttribute</span>();</span><br><span class="line">	VigorDef.AttributeSource = EGameplayEffectAttributeCaptureSource::Target;</span><br><span class="line">	VigorDef.bSnapshot = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">	RelevantAttributesToCapture.<span class="built_in">Add</span>(VigorDef);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">float</span> <span class="title">UMMC_MaxHealth::CalculateBaseMagnitude_Implementation</span><span class="params">(<span class="type">const</span> FGameplayEffectSpec&amp; Spec)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;	</span><br><span class="line">	<span class="type">const</span> FGameplayTagContainer* SourceTags = Spec.CapturedSourceTags.<span class="built_in">GetAggregatedTags</span>();</span><br><span class="line">	<span class="type">const</span> FGameplayTagContainer* TargetTags = Spec.CapturedTargetTags.<span class="built_in">GetAggregatedTags</span>();</span><br><span class="line">	FAggregatorEvaluateParameters EvaluateParameters;</span><br><span class="line">	EvaluateParameters.SourceTags = SourceTags;</span><br><span class="line">	EvaluateParameters.TargetTags = TargetTags;</span><br><span class="line"></span><br><span class="line">	<span class="type">float</span> Vigor = <span class="number">0.f</span>;</span><br><span class="line">	<span class="built_in">GetCapturedAttributeMagnitude</span>(VigorDef , Spec , EvaluateParameters , Vigor);</span><br><span class="line">	Vigor = FMath::<span class="built_in">Max</span>&lt;<span class="type">float</span>&gt;(Vigor , <span class="number">0.f</span>);</span><br><span class="line"></span><br><span class="line">	int32 PlayerLevel = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (Spec.<span class="built_in">GetContext</span>().<span class="built_in">GetSourceObject</span>()-&gt;<span class="built_in">Implements</span>&lt;UCombatInterface&gt;())</span><br><span class="line">	&#123;</span><br><span class="line">		PlayerLevel = ICombatInterface::<span class="built_in">Execute_GetPlayerLevel</span>(Spec.<span class="built_in">GetContext</span>().<span class="built_in">GetSourceObject</span>());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">80.f</span> + <span class="number">2.5f</span> * Vigor + <span class="number">10.f</span> * PlayerLevel;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/ue5-blog/tags/GAS/" rel="tag"># GAS</a>
              <a href="/ue5-blog/tags/GE/" rel="tag"># GE</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/ue5-blog/2025/12/12/GAS-GameplayEvent/" rel="prev" title="GameplayEvent">
                  <i class="fa fa-angle-left"></i> GameplayEvent
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/ue5-blog/2025/12/12/GAS-AS/" rel="next" title="AttributeSet (AS)">
                  AttributeSet (AS) <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Larry-lyx</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
